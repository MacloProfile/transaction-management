{% extends 'employee_table/base.html' %}
{% load static %}

{% block extra_head %}
    <title>Таблица сотрудников</title>
    <style>
        .clickable {
            color: #2563eb;
            cursor: pointer;
            text-decoration: underline;
        }
        .clickable:hover {
            color: #1d4ed8;
        }
        .calls {
            font-weight: bold;
            color: #10b981;
        }
    </style>
<script src="https://unpkg.com/@bitrix24/b24jssdk@latest/dist/umd/index.min.js"></script>
{% endblock %}

{% block content %}
    <h1>Таблица сотрудников</h1>

    <table>
        <thead>
            <tr>
                <th>Сотрудник</th>
                <th>Руководители</th>
                <th>Звонки за 24 часа</th>
            </tr>
        </thead>
        <tbody>
            {% for row in table_data %}
            <tr>
                <td class="clickable" onclick="openEmployeeSlider({{ row.employee_id }})">{{ row.employee_name }}</td>
                <td>{{ row.managers_chain|default:"-" }}</td>
                <td class="calls">{{ row.calls_last_24h }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        async function openEmployeeSlider(userId) {
            try {
                const $b24 = await B24Js.initializeB24Frame();
                $b24.slider.openPath(
                    $b24.slider.getUrl(`/company/personal/user/${userId}/`),
                    800
                );
            } catch (err) {
                console.error(err);
            }
        }
    </script>
{% endblock %}